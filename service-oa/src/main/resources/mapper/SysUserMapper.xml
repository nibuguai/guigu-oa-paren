<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wq.mapper.SysUserMapper">
    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.atguigu.model.system.SysUser">
        <id column="id" property="id"/>
        <result column="username" property="username"/>
        <result column="password" property="password"/>
        <result column="name" property="name"/>
        <result column="phone" property="phone"/>
        <result column="head_url" property="headUrl"/>
        <result column="dept_id" property="deptId"/>
        <result column="post_id" property="postId"/>
        <result column="open_id" property="openId"/>
        <result column="description" property="description"/>
        <result column="status" property="status"/>
        <result column="create_time" property="createTime"/>
        <result column="update_time" property="updateTime"/>
        <result column="is_deleted" property="isDeleted"/>
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id,
        username,
        password,
        name,
        phone,
        head_url,
        dept_id,
        post_id,
        open_id,
        description,
        status,
        create_time,
        update_time,
        is_deleted
    </sql>

    <select id="getUserList" resultType="com.wq.pojo.rsp.GetUserListRsp" parameterType="com.wq.pojo.req.GetUserListReq">
        SELECT u.username,
               u.name,
               u.phone,
               d.name        AS dept_name,
               p.name        AS post_name,
               u.status,
               u.create_time as createTime
        FROM sys_user u
                     LEFT JOIN sys_dept d ON u.dept_id = d.id
                     LEFT JOIN sys_post p ON u.post_id = p.id
                WHERE
                1 = 1
        <if test="keyword != null and keyword != ''">
            AND (
                    u.username LIKE CONCAT('%', #{keyword}, '%')
                            OR u.name LIKE CONCAT('%', #{keyword}, '%')
                            OR u.phone LIKE CONCAT('%', #{keyword}, '%')
                            OR d.name LIKE CONCAT('%', #{keyword}, '%')
                            OR p.name LIKE CONCAT('%', #{keyword}, '%')
                    )
        </if>
        <if test="createdTimeStart != null and createdTimeEnd != null">
            AND u.create_time BETWEEN #{createdTimeStart} AND #{createdTimeEnd}
        </if>
        ORDER BY u.create_time DESC
        LIMIT #{limit} OFFSET #{page}
    </select>


    <select id="getUserListCont" resultType="int" parameterType="com.wq.pojo.req.GetUserListReq">
        SELECT count(*)
        FROM sys_user u
                     LEFT JOIN sys_dept d ON u.dept_id = d.id
                     LEFT JOIN sys_post p ON u.post_id = p.id
                WHERE
                1 = 1
        <if test="keyword != null and keyword != ''">
            AND (
                    u.username LIKE CONCAT('%', #{keyword}, '%')
                            OR u.name LIKE CONCAT('%', #{keyword}, '%')
                            OR u.phone LIKE CONCAT('%', #{keyword}, '%')
                            OR d.name LIKE CONCAT('%', #{keyword}, '%')
                            OR p.name LIKE CONCAT('%', #{keyword}, '%')
                    )
        </if>
        <if test="createdTimeStart != null and createdTimeEnd != null">
            AND u.create_time BETWEEN #{createdTimeStart} AND #{createdTimeEnd}
        </if>
        ORDER BY u.create_time DESC
    </select>
</mapper>
